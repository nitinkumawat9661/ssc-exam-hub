<!DOCTYPE html>
<html lang="en">
<head>
    <title>Login - SSC Hub</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <style>
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; }
        .login-box { background: white; padding: 30px; border-radius: 15px; width: 90%; max-width: 400px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.2); z-index: 10; }
        .btn-google { background: white; color: #333; font-weight: bold; border: 1px solid #ddd; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .divider { display: flex; align-items: center; margin: 20px 0; font-size: 12px; color: #888; }
        .divider::before, .divider::after { content: ""; flex: 1; border-bottom: 1px solid #ddd; margin: 0 10px; }
        
        /* WhatsApp Float Button */
        .wa-float { position: fixed; bottom: 20px; right: 20px; background-color: #25d366; color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; box-shadow: 2px 2px 10px rgba(0,0,0,0.2); z-index: 100; text-decoration: none; }
        .wa-float:hover { background-color: #1ebe57; color: white; }

        /* Footer Credit */
        .footer-credit { position: fixed; bottom: 10px; width: 100%; text-align: center; color: rgba(255, 255, 255, 0.7); font-size: 12px; z-index: 5; }
    </style>
</head>
<body>
    <div class="login-box">
        <h3 class="fw-bold text-primary mb-4">SSC Exam Hub üöÄ</h3>
        <div id="error-box" class="alert alert-danger d-none small"></div>

        <!-- ‚úÖ GOOGLE LOGIN -->
        <button onclick="googleLogin()" class="btn btn-google w-100 py-2 mb-3 shadow-sm">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20"> Sign in with Google
        </button>

        <div class="divider">OR USE EMAIL</div>

        <!-- ‚úÖ EMAIL LOGIN (Admin Access) -->
        <input type="email" id="email" class="form-control mb-2" placeholder="Email (e.g. nitin@gmail.com)">
        <input type="password" id="password" class="form-control mb-3" placeholder="Password">
        <button onclick="emailLogin()" class="btn btn-primary w-100 fw-bold">Login / Sign Up</button>
        
        <p id="status" class="text-muted small mt-3"></p>
    </div>

    <!-- Footer Name -->
    <div class="footer-credit">Designed & Developed by <b>Nitin Kumawat</b> ‚ù§Ô∏è</div>

    <!-- WhatsApp Help Button -->
    <a href="https://wa.me/917665853321?text=Hello%20Sir,%20I%20need%20help%20with%20SSC%20Hub%20App" class="wa-float" target="_blank">
        <i class="fab fa-whatsapp"></i>
    </a>

    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyD0hwAADeX16Y_0WeOewn-WK9NMMFaGhE4",
            authDomain: "nitin-first-app.firebaseapp.com",
            projectId: "nitin-first-app",
            storageBucket: "nitin-first-app.firebasestorage.app",
            messagingSenderId: "435472439420",
            appId: "1:435472439420:web:4da5fe290ab0422608d1f9"
        };
        firebase.initializeApp(firebaseConfig);

        function googleLogin() {
            var provider = new firebase.auth.GoogleAuthProvider();
            firebase.auth().signInWithPopup(provider)
                .then((result) => handleAuth(result.user))
                .catch((error) => showError(error.message));
        }

        function emailLogin() {
            let email = document.getElementById('email').value;
            let pass = document.getElementById('password').value;
            
            if(!email || !pass) return showError("Please enter Email and Password");
            document.getElementById('status').innerText = "Checking...";
            
            firebase.auth().signInWithEmailAndPassword(email, pass)
            .then((result) => handleAuth(result.user))
            .catch((error) => {
                if(error.code === 'auth/user-not-found') {
                    if(confirm("Account nahi mila. Kya naya bana dun?")) {
                        firebase.auth().createUserWithEmailAndPassword(email, pass)
                        .then((result) => handleAuth(result.user))
                        .catch((e) => showError(e.message));
                    }
                } else {
                    showError(error.message);
                }
            });
        }

        function handleAuth(user) {
            document.getElementById('status').innerText = "Login Success! Redirecting...";
            fetch('/firebase_login', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ 
                    uid: user.uid, 
                    email: user.email, 
                    name: user.displayName || user.email.split('@')[0] 
                })
            }).then(r => r.json()).then(data => {
                if(data.status === 'success') {
                    window.location.href = "/dashboard";
                } else {
                    showError(data.message);
                }
            });
        }

        function showError(msg) {
            let box = document.getElementById('error-box');
            box.innerText = "‚ö†Ô∏è " + msg;
            box.classList.remove('d-none');
            document.getElementById('status').innerText = "";
        }
    </script>
</body>
</html>
